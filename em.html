<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é«˜çº§å°çƒæ§åˆ¶ - ä¼˜åŒ–ç‰ˆ</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: #2c3e50;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
      #ball {
        position: absolute;
        width: 50px;
        height: 50px;
        background: radial-gradient(circle at 30% 30%, #ff6f61, #e74c3c);
        border-radius: 50%;
        box-shadow: 0 0 20px rgba(231, 76, 60, 0.5),
          0 5px 15px rgba(0, 0, 0, 0.3);
        transform: translate(-50%, -50%);
        transition: transform 0.1s;
      }
      #ball::after {
        content: "";
        position: absolute;
        top: 15%;
        left: 15%;
        width: 20%;
        height: 20%;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
      }
      #permissionBtn {
        position: fixed;
        top: 20px;
        padding: 10px 20px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      #emoji {
        position: absolute;
        font-size: 40px;
        transition: all 0.3s;
        transform: translate(-50%, -50%);
        pointer-events: none;
      }
      .calm {
        filter: drop-shadow(0 0 10px #00ff00);
      }
      .scared {
        filter: drop-shadow(0 0 10px #ff0000);
      }
    </style>
  </head>
  <body>
    <button id="permissionBtn">è¯·æ±‚éœ‡åŠ¨æƒé™</button>
    <div id="ball"></div>
    <div id="emoji">ğŸ˜ƒ</div>

    <script>
      // è·å–å…ƒç´ 
      const ball = document.getElementById("ball");
      const permissionBtn = document.getElementById("permissionBtn");

      // ç‰©ç†å‚æ•°é…ç½®
      const config = {
        accelerationFactor: 0.05, // åŠ é€Ÿåº¦ç³»æ•°ï¼ˆå¢å¤§çµæ•åº¦ï¼‰
        damping: 0.92, // é˜»å°¼ç³»æ•°ï¼ˆæ›´å¿«å‡é€Ÿï¼‰
        bounceFactor: 0.05, // åå¼¹åŠ›åº¦
        minSpeed: 0.1, // æœ€å°é€Ÿåº¦ï¼ˆä½äºæ­¤å€¼ä¼šåœæ­¢ï¼‰
        deadZone: 5, // é™€èºä»ªæ­»åŒºï¼ˆå¿½ç•¥å¾®å°ç§»åŠ¨ï¼‰
        maxVibration: 30, // æœ€å¤§éœ‡åŠ¨æ—¶é•¿
      };

      // åˆå§‹åŒ–çŠ¶æ€
      let screenWidth, screenHeight;
      let posX, posY;
      let velocityX = 0,
        velocityY = 0;

      // æ–°å¢Emojiå‚æ•°
      const emojiConfig = {
        baseSpeed: 2,
        panicDistance: 200,
        maxSpeed: 5,
        calmSpeed: 0.5,
        updateInterval: 100,
      };

      let emoji = document.getElementById("emoji");
      let emojiX = 0,
        emojiY = 0,
        emojiVX = 0,
        emojiVY = 0;

      // åˆå§‹åŒ–Emojiä½ç½®
      function initEmoji() {
        emojiX = Math.random() * (screenWidth - 100) + 50;
        emojiY = Math.random() * (screenHeight - 100) + 50;
        emoji.style.left = `${emojiX}px`;
        emoji.style.top = `${emojiY}px`;
      }

      // åˆå§‹åŒ–å‡½æ•°
      function init() {
        screenWidth = window.innerWidth;
        screenHeight = window.innerHeight;
        posX = Math.min(screenWidth - 25, Math.max(25, screenWidth / 2));
        posY = Math.min(screenHeight - 25, Math.max(25, screenHeight / 2));
        ball.style.left = `${posX}px`;
        ball.style.top = `${posY}px`;
      }

      // éœ‡åŠ¨æƒé™è¯·æ±‚ï¼ˆåŒä¹‹å‰ç‰ˆæœ¬ï¼‰
      permissionBtn.addEventListener("click", async () => {
        try {
          if (navigator.vibrate) {
            await navigator.permissions.query({ name: "vibrate" });
            navigator.vibrate(10); // çŸ­æš‚éœ‡åŠ¨æµ‹è¯•
            permissionBtn.style.display = "none";
          }
        } catch (e) {
          console.log("Vibration API not supported");
        }
      });

      // æ›´æ–°å‡½æ•°ï¼ˆå«é˜²æŠ–åŠ¨ä¼˜åŒ–ï¼‰
      function update() {
        // æ›´æ–°ä½ç½®
        posX += velocityX;
        posY += velocityY;

        // è¾¹ç•Œç¢°æ’æ£€æµ‹ï¼ˆç²¾ç¡®åˆ°åƒç´ ï¼‰
        const ballRadius = 25; // æ˜ç¡®æŒ‡å®šåŠå¾„ï¼ˆé¿å…offsetWidthè¯¯å·®ï¼‰
        let bounced = false;

        // æ–°å¢Emojiæ™ºèƒ½ç§»åŠ¨
        const dx = posX - emojiX;
        const dy = posY - emojiY;
        const distance = Math.sqrt(dx * dx + dy * dy);

        // æ ¹æ®è·ç¦»è°ƒæ•´è¡¨æƒ…å’Œé€Ÿåº¦
        if (distance < emojiConfig.panicDistance) {
          // ææ…ŒçŠ¶æ€
          emoji.textContent = "ğŸ˜°";
          emoji.className = "scared";

          // è®¡ç®—é€ƒç¦»æ–¹å‘
          const angle = Math.atan2(dy, dx);
          const speed = Math.min(
            emojiConfig.baseSpeed + (emojiConfig.panicDistance - distance) / 50,
            emojiConfig.maxSpeed
          );

          emojiVX = -Math.cos(angle) * speed;
          emojiVY = -Math.sin(angle) * speed;
        } else {
          // å¹³é™çŠ¶æ€
          emoji.textContent = "ğŸ˜ƒ";
          emoji.className = "calm";

          // éšæœºæ¼«æ­¥
          if (Math.random() < 0.02) {
            emojiVX = (Math.random() - 0.5) * emojiConfig.calmSpeed;
            emojiVY = (Math.random() - 0.5) * emojiConfig.calmSpeed;
          }
        }

        // æ›´æ–°Emojiä½ç½®
        emojiX += emojiVX;
        emojiY += emojiVY;

        // Emojiè¾¹ç•Œæ£€æµ‹
        emojiX = Math.max(30, Math.min(screenWidth - 30, emojiX));
        emojiY = Math.max(30, Math.min(screenHeight - 30, emojiY));

        emoji.style.left = `${emojiX}px`;
        emoji.style.top = `${emojiY}px`;

        // æ°´å¹³è¾¹ç•Œ
        if (posX < ballRadius) {
          velocityX = Math.abs(velocityX) * config.bounceFactor;
          posX = ballRadius;
          bounced = true;
        } else if (posX > screenWidth - ballRadius) {
          velocityX = -Math.abs(velocityX) * config.bounceFactor;
          posX = screenWidth - ballRadius;
          bounced = true;
        }

        // å‚ç›´è¾¹ç•Œ
        if (posY < ballRadius) {
          velocityY = Math.abs(velocityY) * config.bounceFactor;
          posY = ballRadius;
          bounced = true;
        } else if (posY > screenHeight - ballRadius) {
          velocityY = -Math.abs(velocityY) * config.bounceFactor;
          posY = screenHeight - ballRadius;
          bounced = true;
        }

        // è§¦è§‰åé¦ˆä¼˜åŒ–ï¼ˆåªåœ¨æ˜¾è‘—ç¢°æ’æ—¶è§¦å‘ï¼‰
        if (bounced && (Math.abs(velocityX) > 1 || Math.abs(velocityY) > 1)) {
          const intensity = Math.min(
            (Math.abs(velocityX) + Math.abs(velocityY)) * 3,
            config.maxVibration
          );
          navigator.vibrate(intensity);
        }

        // é€Ÿåº¦è¡°å‡ + é˜²æŠ–åŠ¨åœæ­¢
        velocityX *= config.damping;
        velocityY *= config.damping;
        if (Math.abs(velocityX) < config.minSpeed) velocityX = 0;
        if (Math.abs(velocityY) < config.minSpeed) velocityY = 0;

        // æ›´æ–°ä½ç½®
        ball.style.left = `${posX}px`;
        ball.style.top = `${posY}px`;

        // 3D å€¾æ–œæ•ˆæœï¼ˆä¼˜åŒ–å¹³æ»‘åº¦ï¼‰
        ball.style.transform = `translate(-50%, -50%) 
                rotateX(${velocityY * 0.8}deg) 
                rotateY(${velocityX * 0.8}deg)`;

        requestAnimationFrame(update);
      }

      // é™€èºä»ªç›‘å¬ï¼ˆå¢åŠ æ­»åŒºè¿‡æ»¤ï¼‰
      window.addEventListener("deviceorientation", (event) => {
        let beta = event.beta || 0;
        let gamma = event.gamma || 0;

        // æ­»åŒºè¿‡æ»¤ï¼ˆå¿½ç•¥å¾®å°ç§»åŠ¨ï¼‰
        if (Math.abs(beta) < config.deadZone) beta = 0;
        if (Math.abs(gamma) < config.deadZone) gamma = 0;

        velocityX += gamma * config.accelerationFactor;
        velocityY += beta * config.accelerationFactor;
      });

      // çª—å£å¤§å°å˜åŒ–å¤„ç†ï¼ˆé‡è¦ï¼ï¼‰
      window.addEventListener("resize", () => {
        init(); // é‡ç½®è¾¹ç•Œ
        initEmoji();
        velocityX = velocityY = 0; // æ¸…é™¤é€Ÿåº¦
      });

      // å¯åŠ¨
      init();
      initEmoji();
      update();
    </script>
  </body>
</html>
