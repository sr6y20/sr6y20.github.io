<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½è¿½é€æ¸¸æˆ</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #ball {
            position: absolute;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle at 30% 30%, #ff6f61, #e74c3c);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5),
                0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translate(-50%, -50%);
            transition: transform 0.1s;
        }
        #ball::after {
            content: "";
            position: absolute;
            top: 15%;
            left: 15%;
            width: 20%;
            height: 20%;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
        }
        #permissionBtn {
            position: fixed;
            top: 20px;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #emoji {
            position: absolute;
            font-size: 40px;
            transition: all 0.3s;
            transform: translate(-50%, -50%);
            pointer-events: none;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .calm { filter: drop-shadow(0 0 15px #00ff00a0); }
        .scared { filter: drop-shadow(0 0 15px #ff0000a0); }
    </style>
</head>
<body>
    <button id="permissionBtn">è¯·æ±‚éœ‡åŠ¨æƒé™</button>
    <div id="ball"></div>
    <div id="emoji">ğŸ˜ƒ</div>

    <script>
        // å…ƒç´ è·å–
        const ball = document.getElementById("ball");
        const emoji = document.getElementById("emoji");
        const permissionBtn = document.getElementById("permissionBtn");

        // ç‰©ç†å‚æ•°é…ç½®
        const config = {
            accelerationFactor: 0.02,   // åŠ é€Ÿåº¦ç³»æ•°
            damping: 0.95,              // é˜»å°¼ç³»æ•°
            maxSpeed: 2,                // æœ€å¤§é€Ÿåº¦
            bounceFactor: 0.05,         // åå¼¹åŠ›åº¦
            minSpeed: 0.1,              // æœ€å°é€Ÿåº¦
            deadZone: 3,                // é™€èºä»ªæ­»åŒº
            maxVibration: 20            // æœ€å¤§éœ‡åŠ¨æ—¶é•¿
        };

        // Emojiå‚æ•°é…ç½®
        const emojiConfig = {
            baseSpeed: 1,               // åŸºç¡€ç§»åŠ¨é€Ÿåº¦
            panicDistance: 150,         // å¼€å§‹é€ƒè·‘çš„è·ç¦»
            maxSpeed: 3,               // æœ€å¤§é€ƒè·‘é€Ÿåº¦
            calmSpeed: 0.3,            // å¹³é™çŠ¶æ€ç§»åŠ¨é€Ÿåº¦
            updateInterval: 100         // AIååº”é—´éš”
        };

        // ç³»ç»ŸçŠ¶æ€
        let screenWidth, screenHeight;
        let posX, posY;
        let velocityX = 0, velocityY = 0;
        let emojiX = 0, emojiY = 0, emojiVX = 0, emojiVY = 0;
        let smoothBeta = 0, smoothGamma = 0;

        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            screenWidth = window.innerWidth;
            screenHeight = window.innerHeight;
            
            // å°çƒåˆå§‹ä½ç½®
            posX = Math.min(screenWidth - 25, Math.max(25, screenWidth / 2));
            posY = Math.min(screenHeight - 25, Math.max(25, screenHeight / 2));
            ball.style.left = `${posX}px`;
            ball.style.top = `${posY}px`;

            // Emojiåˆå§‹ä½ç½®
            initEmoji();
        }

        // Emojiåˆå§‹åŒ–
        function initEmoji() {
            emojiX = Math.random() * (screenWidth - 100) + 50;
            emojiY = Math.random() * (screenHeight - 100) + 50;
            emoji.style.left = `${emojiX}px`;
            emoji.style.top = `${emojiY}px`;
        }

        // éœ‡åŠ¨æƒé™è¯·æ±‚
        permissionBtn.addEventListener("click", async () => {
            try {
                if (navigator.vibrate) {
                    await navigator.permissions.query({ name: "vibrate" });
                    navigator.vibrate(10);
                    permissionBtn.style.display = "none";
                }
            } catch (e) {
                console.log("Vibration API not supported");
            }
        });

        // æ¸¸æˆä¸»å¾ªç¯
        function update() {
            // æ›´æ–°å°çƒä½ç½®
            posX += velocityX;
            posY += velocityY;

            // è¾¹ç•Œç¢°æ’æ£€æµ‹
            const ballRadius = 25;
            let bounced = false;

            // æ°´å¹³è¾¹ç•Œ
            if (posX < ballRadius) {
                velocityX = Math.abs(velocityX) * config.bounceFactor;
                posX = ballRadius;
                bounced = true;
            } else if (posX > screenWidth - ballRadius) {
                velocityX = -Math.abs(velocityX) * config.bounceFactor;
                posX = screenWidth - ballRadius;
                bounced = true;
            }

            // å‚ç›´è¾¹ç•Œ
            if (posY < ballRadius) {
                velocityY = Math.abs(velocityY) * config.bounceFactor;
                posY = ballRadius;
                bounced = true;
            } else if (posY > screenHeight - ballRadius) {
                velocityY = -Math.abs(velocityY) * config.bounceFactor;
                posY = screenHeight - ballRadius;
                bounced = true;
            }

            // è§¦è§‰åé¦ˆ
            if (bounced && (Math.abs(velocityX) > 0.5 || Math.abs(velocityY) > 0.5)) {
                const intensity = Math.min(
                    (Math.abs(velocityX) + Math.abs(velocityY)) * 2,
                    config.maxVibration
                );
                navigator.vibrate(intensity);
            }

            // é€Ÿåº¦è¡°å‡
            velocityX *= config.damping;
            velocityY *= config.damping;
            if (Math.abs(velocityX) < config.minSpeed) velocityX = 0;
            if (Math.abs(velocityY) < config.minSpeed) velocityY = 0;

            // æ›´æ–°å°çƒä½ç½®
            ball.style.left = `${posX}px`;
            ball.style.top = `${posY}px`;

            // å€¾æ–œæ•ˆæœ
            ball.style.transform = `translate(-50%, -50%) 
                rotateX(${velocityY * 0.6}deg) 
                rotateY(${velocityX * 0.6}deg)`;

            // æ›´æ–°Emojiè¡Œä¸º
            updateEmoji();
            
            requestAnimationFrame(update);
        }

        // Emoji AIé€»è¾‘
        function updateEmoji() {
            const dx = posX - emojiX;
            const dy = posY - emojiY;
            const distance = Math.sqrt(dx*dx + dy*dy);
            
            if(distance < emojiConfig.panicDistance) {
                // ææ…ŒçŠ¶æ€
                emoji.textContent = 'ğŸ˜°';
                emoji.className = 'scared';
                
                const angle = Math.atan2(dy, dx);
                const speed = Math.min(
                    emojiConfig.baseSpeed + (emojiConfig.panicDistance - distance)/40,
                    emojiConfig.maxSpeed
                );
                
                emojiVX = -Math.cos(angle) * speed;
                emojiVY = -Math.sin(angle) * speed;
            } else {
                // å¹³é™çŠ¶æ€
                emoji.textContent = 'ğŸ˜ƒ';
                emoji.className = 'calm';
                
                if(Math.random() < 0.02) {
                    emojiVX = (Math.random() - 0.5) * emojiConfig.calmSpeed;
                    emojiVY = (Math.random() - 0.5) * emojiConfig.calmSpeed;
                }
            }

            // æ›´æ–°ä½ç½®
            emojiX += emojiVX;
            emojiY += emojiVY;
            
            // è¾¹ç•Œé™åˆ¶
            emojiX = Math.max(30, Math.min(screenWidth - 30, emojiX));
            emojiY = Math.max(30, Math.min(screenHeight - 30, emojiY));
            
            emoji.style.left = `${emojiX}px`;
            emoji.style.top = `${emojiY}px`;
        }

        // é™€èºä»ªå¤„ç†ï¼ˆå¸¦æ»¤æ³¢ï¼‰
        window.addEventListener("deviceorientation", (event) => {
            smoothBeta = 0.3 * (event.beta || 0) + 0.7 * smoothBeta;
            smoothGamma = 0.3 * (event.gamma || 0) + 0.7 * smoothGamma;

            let beta = Math.abs(smoothBeta) < config.deadZone ? 0 : smoothBeta;
            let gamma = Math.abs(smoothGamma) < config.deadZone ? 0 : smoothGamma;

            velocityX += gamma * config.accelerationFactor;
            velocityY += beta * config.accelerationFactor;

            // é€Ÿåº¦é™åˆ¶
            velocityX = Math.max(-config.maxSpeed, Math.min(config.maxSpeed, velocityX));
            velocityY = Math.max(-config.maxSpeed, Math.min(config.maxSpeed, velocityY));
        });

        // çª—å£å¤§å°å˜åŒ–å¤„ç†
        window.addEventListener("resize", () => {
            init();
            velocityX = velocityY = 0;
        });

        // å¯åŠ¨æ¸¸æˆ
        init();
        update();
    </script>
</body>
</html>
